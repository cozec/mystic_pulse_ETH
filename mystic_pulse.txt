Mystic Pulse Strategy PineScript Code
// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Strategy conversion by Bard for Mystic Pulse V2.0
// © chervolino

//@version=6
strategy(title="Mystic Pulse Strategy [Long Only]", shorttitle="MP Strat", overlay=true, initial_capital=100000, default_qty_type=strategy.percent_of_equity, default_qty_value=100, commission_type=strategy.commission.percent, commission_value=0.1, slippage=1)

// ——— SECTION: Inputs
// Kept original inputs for logic consistency
adx_length_input          = input.int(defval=9, title="ADX smoothing length", minval=1)
smoothing_factor_input    = input.int(defval=1, title="OHLC SMA length", minval=1)

// Visual inputs (Optional for strategy, but kept for chart confirmation)
up_dark_color_input = input.color(defval=color.new(#005A00, 0), title="Up dark")
up_neon_color_input = input.color(defval=color.new(#00FF66, 0), title="Up neon")
dn_dark_color_input = input.color(defval=color.new(#7A0000, 0), title="Down dark")
dn_neon_color_input = input.color(defval=color.new(#FF1A1A, 0), title="Down neon")

// ——— SECTION: Core Calculations
// OHLC Smoothing
open_s  = ta.sma(open,  smoothing_factor_input)
high_s  = ta.sma(high,  smoothing_factor_input)
low_s   = ta.sma(low,   smoothing_factor_input)
close_s = ta.sma(close, smoothing_factor_input)

// True Range & DM
true_range = math.max(math.max(high_s - low_s, math.abs(high_s - nz(close_s[1]))), math.abs(low_s - nz(close_s[1])))
dm_plus    = (high_s - nz(high_s[1]) > nz(low_s[1]) - low_s) ? math.max(high_s - nz(high_s[1]), 0) : 0
dm_minus   = (nz(low_s[1]) - low_s > high_s - nz(high_s[1])) ? math.max(nz(low_s[1]) - low_s, 0) : 0

// Wilder's Smoothing (Recursive)
var float smoothed_true_range = na
var float smoothed_dm_plus    = na
var float smoothed_dm_minus   = na

smoothed_true_range := na(smoothed_true_range[1]) ? true_range : (smoothed_true_range[1] - (smoothed_true_range[1] / adx_length_input) + true_range)
smoothed_dm_plus    := na(smoothed_dm_plus[1])    ? dm_plus     : (smoothed_dm_plus[1]    - (smoothed_dm_plus[1]    / adx_length_input) + dm_plus)
smoothed_dm_minus   := na(smoothed_dm_minus[1])   ? dm_minus    : (smoothed_dm_minus[1]   - (smoothed_dm_minus[1]   / adx_length_input) + dm_minus)

denom = smoothed_true_range
di_plus  = (na(denom) or denom == 0) ? na : (smoothed_dm_plus  / denom * 100)
di_minus = (na(denom) or denom == 0) ? na : (smoothed_dm_minus / denom * 100)

// ——— SECTION: Trend Counting Logic
var int   positive_count      = 0
var int   negative_count      = 0

if (not na(di_plus) and not na(di_plus[1]) and di_plus > di_plus[1] and di_plus > di_minus)
    positive_count += 1
    negative_count := 0
if (not na(di_minus) and not na(di_minus[1]) and di_minus > di_minus[1] and di_minus > di_plus)
    negative_count += 1
    positive_count := 0

trend_score = positive_count - negative_count

// ——— SECTION: Strategy Execution
// Date Filter: 2018-2069
inDateRange = time >= timestamp(2018, 01, 01, 00, 00) and time <= timestamp(2069, 12, 31, 23, 59)

// Buy Condition: Trend turns Positive (Bullish Inception)
longCondition = trend_score > 0 and inDateRange

// Sell Condition: Trend is no longer Positive (Bullish Trend Broken)
exitCondition = trend_score <= 0

if (longCondition)
    strategy.entry("Long", strategy.long, comment="Bull Start")

if (exitCondition)
    strategy.close("Long", comment="Trend Break")

// ——— SECTION: Visuals (Bar Coloring for Confirmation)
barcolor(trend_score > 0 ? color.lime : trend_score < 0 ? color.red : color.gray)
